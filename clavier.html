<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Vi·ªát</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="title-bar">
		<h1>H·ªçc ti·∫øng Vi·ªát</h1>
		<a href="index.html" class="button-link home-button">üè†</a>
	</div>

	<div class="vietnamese-keyboard-container"></div>
		<div class="input-container-clavier">
			<input type="text" id="vietnamese-input" class="vietnamese-input" placeholder="Nh·∫≠p vƒÉn b·∫£n..." spellcheck="false">
			<button class="vk-btn copy-btn" onclick="copyText()">üìã Copier</button>
		</div>
		<div id="copy-toast" class="copy-toast">Copi√©</div>

		<div class="keyboard">

			<!-- Row 1: Vietnamese vowels and tones -->
			<div class="row">
				<button class="vk-btn" onclick="insertChar('ƒÉ')">ƒÉ</button>
				<button class="vk-btn" onclick="insertChar('√¢')">√¢</button>
				<button class="vk-btn" onclick="insertChar('√™')">√™</button>
				<button class="vk-btn" onclick="insertChar('√¥')">√¥</button>
				<button class="vk-btn" onclick="insertChar('∆°')">∆°</button>
				<button class="vk-btn" onclick="insertChar('∆∞')">∆∞</button>
				<button class="vk-btn" onclick="addTone('s·∫Øc')">¬¥</button>
				<button class="vk-btn" onclick="addTone('huy·ªÅn')">`</button>
				<button class="vk-btn" onclick="addTone('h·ªèi')">?</button>
				<button class="vk-btn" onclick="addTone('ng√£')">~</button>
				<button class="vk-btn" onclick="addTone('n·∫∑ng')">.</button>
			</div>

			<!-- Row 2 -->
			<div class="row">
				<button class="vk-btn" onclick="insertChar('q')">q</button>
				<button class="vk-btn" onclick="insertChar('w')">w</button>
				<button class="vk-btn" onclick="insertChar('e')">e</button>
				<button class="vk-btn" onclick="insertChar('r')">r</button>
				<button class="vk-btn" onclick="insertChar('t')">t</button>
				<button class="vk-btn" onclick="insertChar('y')">y</button>
				<button class="vk-btn" onclick="insertChar('u')">u</button>
				<button class="vk-btn" onclick="insertChar('i')">i</button>
				<button class="vk-btn" onclick="insertChar('o')">o</button>
				<button class="vk-btn" onclick="insertChar('p')">p</button>
			</div>

			<!-- Row 3 -->
			<div class="row">
				<button class="vk-btn" onclick="insertChar('a')">a</button>
				<button class="vk-btn" onclick="insertChar('s')">s</button>
				<button class="vk-btn" onclick="insertChar('d')">d</button>
				<button class="vk-btn" onclick="insertChar('f')">f</button>
				<button class="vk-btn" onclick="insertChar('g')">g</button>
				<button class="vk-btn" onclick="insertChar('h')">h</button>
				<button class="vk-btn" onclick="insertChar('j')">j</button>
				<button class="vk-btn" onclick="insertChar('k')">k</button>
				<button class="vk-btn" onclick="insertChar('l')">l</button>
				<button class="vk-btn" onclick="insertChar('ƒë')">ƒë</button>
			</div>

			<!-- Row 4 -->
			<div class="row">
				<button class="vk-btn" onclick="insertChar('z')">z</button>
				<button class="vk-btn" onclick="insertChar('x')">x</button>
				<button class="vk-btn" onclick="insertChar('c')">c</button>
				<button class="vk-btn" onclick="insertChar('v')">v</button>
				<button class="vk-btn" onclick="insertChar('b')">b</button>
				<button class="vk-btn" onclick="insertChar('n')">n</button>
				<button class="vk-btn" onclick="insertChar('m')">m</button>
			</div>

			<!-- Row 5: Vietnamese digraphs -->
			<div class="row">
				<button class="vk-btn" onclick="insertChar('ch')">ch</button>
				<button class="vk-btn" onclick="insertChar('gh')">gh</button>
				<button class="vk-btn" onclick="insertChar('gi')">gi</button>
				<button class="vk-btn" onclick="insertChar('kh')">kh</button>
				<button class="vk-btn" onclick="insertChar('ng')">ng</button>
				<button class="vk-btn" onclick="insertChar('ngh')">ngh</button>
				<button class="vk-btn" onclick="insertChar('nh')">nh</button>
				<button class="vk-btn" onclick="insertChar('ph')">ph</button>
				<button class="vk-btn" onclick="insertChar('th')">th</button>
				<button class="vk-btn" onclick="insertChar('tr')">tr</button>
			</div>

		</div>
	</div>

	<script>
		let lastChar = ''; // Le dernier caract√®re (ou digraphe) ins√©r√©
	
		const toneMap = {
			'a':  { 's·∫Øc': '√°', 'huy·ªÅn': '√†', 'h·ªèi': '·∫£', 'ng√£': '√£', 'n·∫∑ng': '·∫°' },
			'ƒÉ':  { 's·∫Øc': '·∫Ø', 'huy·ªÅn': '·∫±', 'h·ªèi': '·∫≥', 'ng√£': '·∫µ', 'n·∫∑ng': '·∫∑' },
			'√¢':  { 's·∫Øc': '·∫•', 'huy·ªÅn': '·∫ß', 'h·ªèi': '·∫©', 'ng√£': '·∫´', 'n·∫∑ng': '·∫≠' },
			'e':  { 's·∫Øc': '√©', 'huy·ªÅn': '√®', 'h·ªèi': '·∫ª', 'ng√£': '·∫Ω', 'n·∫∑ng': '·∫π' },
			'√™':  { 's·∫Øc': '·∫ø', 'huy·ªÅn': '·ªÅ', 'h·ªèi': '·ªÉ', 'ng√£': '·ªÖ', 'n·∫∑ng': '·ªá' },
			'i':  { 's·∫Øc': '√≠', 'huy·ªÅn': '√¨', 'h·ªèi': '·ªâ', 'ng√£': 'ƒ©', 'n·∫∑ng': '·ªã' },
			'o':  { 's·∫Øc': '√≥', 'huy·ªÅn': '√≤', 'h·ªèi': '·ªè', 'ng√£': '√µ', 'n·∫∑ng': '·ªç' },
			'√¥':  { 's·∫Øc': '·ªë', 'huy·ªÅn': '·ªì', 'h·ªèi': '·ªï', 'ng√£': '·ªó', 'n·∫∑ng': '·ªô' },
			'∆°':  { 's·∫Øc': '·ªõ', 'huy·ªÅn': '·ªù', 'h·ªèi': '·ªü', 'ng√£': '·ª°', 'n·∫∑ng': '·ª£' },
			'u':  { 's·∫Øc': '√∫', 'huy·ªÅn': '√π', 'h·ªèi': '·ªß', 'ng√£': '≈©', 'n·∫∑ng': '·ª•' },
			'∆∞':  { 's·∫Øc': '·ª©', 'huy·ªÅn': '·ª´', 'h·ªèi': '·ª≠', 'ng√£': '·ªØ', 'n·∫∑ng': '·ª±' },
			'y':  { 's·∫Øc': '√Ω', 'huy·ªÅn': '·ª≥', 'h·ªèi': '·ª∑', 'ng√£': '·ªπ', 'n·∫∑ng': '·ªµ' }
		};
	
		function insertChar(char) {
			const input = document.getElementById('vietnamese-input');
			const start = input.selectionStart;
			const end = input.selectionEnd;
			const text = input.value;
	
			// Ins√®re le caract√®re ou le digraphe √† la position du curseur
			input.value = text.slice(0, start) + char + text.slice(end);
			input.focus();
			input.selectionStart = input.selectionEnd = start + char.length;
			lastChar = char;
		}
	
		function addTone(tone) {
			const input = document.getElementById('vietnamese-input');
			const text = input.value;
			if (!text || !lastChar) return;
	
			// 1) V√©rifier si lastChar est le digraphe "gi" (√©ventuellement d√©j√† ton√©, par ex. "g√≠")
			let isGi = false;
			let prefix = '';
			let vowelPart = '';
	
			if (lastChar.length >= 2 && lastChar[0] === 'g') {
				// On prend tout ce qui suit le 'g' comme "vowelPart"
				vowelPart = lastChar.slice(1); 
				// Si vowelPart est 'i' ou une version ton√©e de 'i', on traite comme "gi"
				const allItones = Object.values(toneMap['i']);
				if (vowelPart === 'i' || allItones.includes(vowelPart)) {
					isGi = true;
					prefix = 'g';
				}
			}
	
			if (isGi) {
				// On trouve la nouvelle voyelle ton√©e pour 'i'
				const newVowel = toneMap['i'][tone];
				if (!newVowel) return;
	
				// On cherche la derni√®re occurrence de lastChar dans le texte
				const idx = text.lastIndexOf(lastChar);
				if (idx !== -1) {
					// Reconstruit la cha√Æne : tout avant "gi"/"g√≠"/etc, puis "g" + newVowel, puis tout apr√®s
					input.value =
						text.substring(0, idx) +
						prefix + newVowel +
						text.substring(idx + lastChar.length);
					input.focus();
					// On place le curseur juste apr√®s le nouveau digraphe ton√©
					input.selectionStart = input.selectionEnd = idx + prefix.length + 1;
					// Met √† jour lastChar (ex. "gƒ©", "g√¨", "g√≠", etc.)
					lastChar = prefix + newVowel;
				}
				return;
			}
	
			// 2) Cas ¬´ lettre simple ¬ª : lastChar peut √™tre d√©j√† ton√© (ex. "√≥") ou non (ex. "o").
			// On d√©termine sa base non-ton√©e en fouillant toneMap.
			let baseLetter = null;
			for (const b in toneMap) {
				// Si lastChar correspond d√©j√† √† la lettre de base
				if (b === lastChar) {
					baseLetter = b;
					break;
				}
				// Sinon, on cherche parmi les valeurs ton√©es de toneMap[b]
				for (const tName in toneMap[b]) {
					if (toneMap[b][tName] === lastChar) {
						baseLetter = b;
						break;
					}
				}
				if (baseLetter) break;
			}
			if (!baseLetter) return;
	
			// On r√©cup√®re la nouvelle version ton√©e de cette base
			const newChar = toneMap[baseLetter][tone];
			if (!newChar) return;
	
			// Remplace la derni√®re occurrence de lastChar par newChar
			const idx2 = text.lastIndexOf(lastChar);
			if (idx2 !== -1) {
				input.value =
					text.substring(0, idx2) +
					newChar +
					text.substring(idx2 + lastChar.length);
				input.focus();
				input.selectionStart = input.selectionEnd = idx2 + 1;
				lastChar = newChar;
			}
		}
	
		function copyText() {
			const input = document.getElementById('vietnamese-input');
			if (!input.value) return;
	
			input.select();
			input.setSelectionRange(0, 99999);
			navigator.clipboard.writeText(input.value).then(() => {
				const toast = document.getElementById('copy-toast');
				toast.classList.add('show');
				setTimeout(() => {
					toast.classList.remove('show');
				}, 1500);
			});
		}
	</script>	
</body>
</html>