<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Vi·ªát</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="title-bar">
		<h1>H·ªçc ti·∫øng Vi·ªát</h1>
		<a href="index.html" class="button-link home-button">üè†</a>
	</div>
    <div class="clock-container">
        <div class="clock-block">
            <div id="clock">
                <div id="hour-hand" class="hand hour-hand" title="Cliquer pour bouger les aiguilles"></div>
                <div id="minute-hand" class="hand minute-hand" title="Cliquer pour bouger les aiguilles"></div>
                <div id="second-hand" class="hand second-hand" title="Cliquer pour bouger les aiguilles"></div>
                <div id="center-dot"></div>
            </div>
            <div id="time-text" contenteditable="true" spellcheck="false" title="Cliquer pour modifier l'heure (format HH:MM:SS)"></div>
        </div>
        <div class="text-block">
            <div id="vietnamese-text" class="vietnamese-time"></div>
        </div>
    </div>

    <script>
        let customTime = null;
        let isEditingTime = false;

        function updateClock() {
            if (isEditingTime) return;

            const now = customTime || new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            const hourDeg = (hours * 30) + (minutes * 0.5);
            const minuteDeg = (minutes * 6) + (seconds * 0.1);
            const secondDeg = seconds * 6;

            document.getElementById('hour-hand').style.transform = `translate(-50%, -100%) rotate(${hourDeg}deg)`;
            document.getElementById('minute-hand').style.transform = `translate(-50%, -100%) rotate(${minuteDeg}deg)`;
            document.getElementById('second-hand').style.transform = `translate(-50%, -100%) rotate(${secondDeg}deg)`;

            const pad = (num) => String(num).padStart(2, '0');
            const timeText = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
            document.getElementById('time-text').textContent = timeText;

            const fullHour = now.getHours();
            const minute = now.getMinutes();
            const second = now.getSeconds();

            const vietnameseHours = [
                "M∆∞·ªùi hai", "M·ªôt", "Hai", "Ba", "B·ªën", "NƒÉm",
                "S√°u", "B·∫£y", "T√°m", "Ch√≠n", "M∆∞·ªùi", "M∆∞·ªùi m·ªôt"
            ];

            const vietnameseMinutes = [
                "kh√¥ng", "m·ªôt", "hai", "ba", "b·ªën", "nƒÉm", "s√°u", "b·∫£y", "t√°m", "ch√≠n",
                "m∆∞·ªùi", "m∆∞·ªùi m·ªôt", "m∆∞·ªùi hai", "m∆∞·ªùi ba", "m∆∞·ªùi b·ªën", "m∆∞·ªùi lƒÉm",
                "m∆∞·ªùi s√°u", "m∆∞·ªùi b·∫£y", "m∆∞·ªùi t√°m", "m∆∞·ªùi ch√≠n", "hai m∆∞∆°i", "hai m∆∞∆°i m·ªët",
                "hai m∆∞∆°i hai", "hai m∆∞∆°i ba", "hai m∆∞∆°i t∆∞", "hai m∆∞∆°i lƒÉm", "hai m∆∞∆°i s√°u",
                "hai m∆∞∆°i b·∫£y", "hai m∆∞∆°i t√°m", "hai m∆∞∆°i ch√≠n", "ba m∆∞∆°i", "ba m∆∞∆°i m·ªët",
                "ba m∆∞∆°i hai", "ba m∆∞∆°i ba", "ba m∆∞∆°i t∆∞", "ba m∆∞∆°i lƒÉm", "ba m∆∞∆°i s√°u",
                "ba m∆∞∆°i b·∫£y", "ba m∆∞∆°i t√°m", "ba m∆∞∆°i ch√≠n", "b·ªën m∆∞∆°i", "b·ªën m∆∞∆°i m·ªët",
                "b·ªën m∆∞∆°i hai", "b·ªën m∆∞∆°i ba", "b·ªën m∆∞∆°i t∆∞", "b·ªën m∆∞∆°i lƒÉm", "b·ªën m∆∞∆°i s√°u",
                "b·ªën m∆∞∆°i b·∫£y", "b·ªën m∆∞∆°i t√°m", "b·ªën m∆∞∆°i ch√≠n", "nƒÉm m∆∞∆°i", "nƒÉm m∆∞∆°i m·ªët",
                "nƒÉm m∆∞∆°i hai", "nƒÉm m∆∞∆°i ba", "nƒÉm m∆∞∆°i t∆∞", "nƒÉm m∆∞∆°i lƒÉm", "nƒÉm m∆∞∆°i s√°u",
                "nƒÉm m∆∞∆°i b·∫£y", "nƒÉm m∆∞∆°i t√°m", "nƒÉm m∆∞∆°i ch√≠n"
            ];

            const vietnameseSeconds = vietnameseMinutes;

            // Determine time of day
            let timeOfDay = "";
            if (fullHour >= 0 && fullHour < 5) {
                timeOfDay = "ƒë√™m";
            } else if (fullHour >= 5 && fullHour < 11) {
                timeOfDay = "s√°ng";
            } else if (fullHour >= 11 && fullHour < 13) {
                timeOfDay = "tr∆∞a";
            } else if (fullHour >= 13 && fullHour < 18) {
                timeOfDay = "chi·ªÅu";
            } else if (fullHour >= 18 && fullHour < 22) {
                timeOfDay = "t·ªëi";
            } else {
                timeOfDay = "ƒë√™m";
            }

            // Get 12-hour display
            let displayHour = fullHour % 12;
            if (displayHour === 0) displayHour = 12;
            const nextHour = (displayHour % 12) + 1;

            let vietnameseHour = vietnameseHours[displayHour % 12];
            const vietnameseNextHour = vietnameseHours[nextHour % 12];
            const vietnameseMinute = vietnameseMinutes[minute];
            const vietnameseSecond = vietnameseSeconds[second];

            // Special case: n·ª≠a ƒë√™m
            const isMidnight = fullHour === 0 && minute === 0 && second === 0;
            if (isMidnight) {
                vietnameseHour = "N·ª≠a ƒë√™m";
            }

            // === Full formal version ===
            let vietnameseTextFull = `<strong>${vietnameseHour}</strong> gi·ªù`;
            if (minute > 0) vietnameseTextFull += ` <strong>${vietnameseMinute}</strong> ph√∫t`;
            if (second > 0) vietnameseTextFull += ` <strong>${vietnameseSecond}</strong> gi√¢y`;
            vietnameseTextFull += ` ${timeOfDay}.`;

            // === Spoken version ===
            let vietnameseTextSpoken = "";
            if (minute === 30) {
                vietnameseTextSpoken = `<strong>${vietnameseHour}</strong> gi·ªù <strong>r∆∞·ª°i</strong>`;
            } else if (minute === 45) {
                vietnameseTextSpoken = `<strong>${vietnameseNextHour}</strong> gi·ªù <strong>k√©m ${vietnameseMinutes[15]}</strong>`;
            } else if (minute === 50) {
                vietnameseTextSpoken = `<strong>${vietnameseNextHour}</strong> gi·ªù <strong>k√©m ${vietnameseMinutes[10]}</strong>`;
            } else if (minute === 55) {
                vietnameseTextSpoken = `<strong>${vietnameseNextHour}</strong> gi·ªù <strong>k√©m ${vietnameseMinutes[5]}</strong>`;
            } else {
                vietnameseTextSpoken = `<strong>${vietnameseHour}</strong> gi·ªù`;
                if (minute > 0) vietnameseTextSpoken += ` <strong>${vietnameseMinute}</strong> ph√∫t`;
            }
            if (second > 0) vietnameseTextSpoken += ` <strong>${vietnameseSecond}</strong> gi√¢y`;
            vietnameseTextSpoken += ` ${timeOfDay}.`;

            // === Display block with stable layout ===
            const block = document.getElementById('vietnamese-text');

            if (vietnameseTextFull === vietnameseTextSpoken) {
                block.innerHTML = `
                    <div style="min-height: 1.6em;">
                        ${vietnameseTextFull}
                    </div>
                    <div style="visibility: hidden; height: 1.6em;">
                        (invisible filler)
                    </div>`;
            } else {
                block.innerHTML = `
                    <div><em>ƒê·∫ßy ƒë·ªß:</em> ${vietnameseTextFull}</div>
                    <div><em>Th√¢n m·∫≠t:</em> ${vietnameseTextSpoken}</div>`;
            }
        }

        function rotateHand(event, handId) {
            const clock = document.getElementById('clock');
            const rect = clock.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const angle = Math.atan2(event.clientY - centerY, event.clientX - centerX) * (180 / Math.PI) + 90;
            const normalizedAngle = (angle + 360) % 360;

            document.getElementById(handId).style.transform = `translate(-50%, -100%) rotate(${normalizedAngle}deg)`;

            customTime = customTime || new Date();

            if (handId === 'hour-hand') {
                const hours = Math.round(normalizedAngle / 30) % 12;
                customTime.setHours(hours);
            } else if (handId === 'minute-hand') {
                const minutes = Math.round(normalizedAngle / 6) % 60;
                customTime.setMinutes(minutes);
            } else if (handId === 'second-hand') {
                const seconds = Math.round(normalizedAngle / 6) % 60;
                customTime.setSeconds(seconds);
            }

            updateClock();
        }

        ['hour-hand', 'minute-hand', 'second-hand'].forEach((id) => {
            document.getElementById(id).addEventListener('mousedown', (event) => {
                customTime = customTime || new Date();
                const moveHandler = (e) => rotateHand(e, id);
                document.addEventListener('mousemove', moveHandler);
                document.addEventListener('mouseup', () => {
                    document.removeEventListener('mousemove', moveHandler);
                }, { once: true });
            });
        });

        const timeInput = document.getElementById('time-text');

        // User starts editing: pause updates
        timeInput.addEventListener('focus', () => {
            isEditingTime = true;
        });

        // On blur or Enter: apply changes and resume updates
        function parseManualTime() {
            const text = timeInput.textContent.trim();
            const match = text.match(/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/);

            if (match) {
                const h = parseInt(match[1]);
                const m = parseInt(match[2]);
                const s = parseInt(match[3]);

                if (
                    h >= 0 && h <= 23 &&
                    m >= 0 && m <= 59 &&
                    s >= 0 && s <= 59
                ) {
                    customTime = new Date();
                    customTime.setHours(h, m, s);
                }
            }

            isEditingTime = false;
            updateClock(); // always reflect parsed time
        }

        timeInput.addEventListener('blur', parseManualTime);

        timeInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // prevent new line
                timeInput.blur();   // triggers parse + resume
            }
        });


        setInterval(() => {
            if (!customTime) {
                updateClock();
            }
        }, 1000);
        updateClock();
    </script>
</body>
</html>