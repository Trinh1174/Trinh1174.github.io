<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Vi·ªát</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="title-bar">
		<h1>H·ªçc ti·∫øng Vi·ªát</h1>
		<a href="index.html" class="button-link home-button">üè†</a>
	</div>

	<div class="switch-bar">
        <button id="btn-heure" class="switch-btn active">Heure</button>
        <button id="btn-dates" class="switch-btn">Dates</button>
        <button id="btn-autres" class="switch-btn">Autres</button>
    </div>

    <div class="clock-container">
        <div class="clock-block">
            <div id="clock">
                <div id="hour-hand" class="hand hour-hand" title="Cliquer pour bouger les aiguilles"></div>
                <div id="minute-hand" class="hand minute-hand" title="Cliquer pour bouger les aiguilles"></div>
                <div id="second-hand" class="hand second-hand" title="Cliquer pour bouger les aiguilles"></div>
                <div id="center-dot"></div>
            </div>
            <div id="time-text" contenteditable="true" spellcheck="false" title="Cliquer pour modifier l'heure (format HH:MM:SS)"></div>
        </div>
        <div class="text-block">
            <div id="vietnamese-text" class="vietnamese-time"></div>
        </div>
    </div>

	<div class="date-container" style="display: none;">
        <div class="calendar-wrapper">
          <!-- 1) En-t√™te du mois en vietnamien + boutons de navigation -->
			<div class="cal-header">
				<button id="prev-month">&laquo;</button>
				<!-- Titre pour mois + ann√©e -->
				<h3 id="month-year" class="month-year"></h3>
				<!-- Toujours un select pour l'ann√©e -->
				<select id="year-select"></select>
				<button id="next-month">&raquo;</button>
			</div>


          <!-- 2) Tableau des jours (lun ‚Üí dim) -->
          <table class="cal-table">
            <thead>
              <tr>
                <th>LUN</th>
                <th>MAR</th>
                <th>MER</th>
                <th>JEU</th>
                <th>VEN</th>
                <th>SAM</th>
                <th>DIM</th>
              </tr>
            </thead>
            <tbody id="calendar-body">
              <!-- Le JavaScript injectera ici les <tr><td>‚Ä¶</td></tr> -->
            </tbody>
          </table>

          <!-- 3) Sous le calendrier, la phrase en vietnamien qui s‚Äôaffiche
                 d√®s qu‚Äôon clique sur un jour -->
          <p id="date-display" class="vietnamese-date"></p>
        </div>
    </div>

    <div class="autres-container" style="display:none;">
        <div class="text-block">
            <p>üöß En cours de d√©veloppement üöß</p>
        </div>
    </div>

    <script>

		function showSection(section) {
            document.querySelector('.clock-container').style.display = section === 'heure' ? '' : 'none';
            document.querySelector('.date-container').style.display = section === 'dates' ? '' : 'none';
            document.querySelector('.autres-container').style.display = section === 'autres' ? '' : 'none';

            document.getElementById('btn-heure').classList.toggle('active', section === 'heure');
            document.getElementById('btn-dates').classList.toggle('active', section === 'dates');
            document.getElementById('btn-autres').classList.toggle('active', section === 'autres');
        }

        document.getElementById('btn-heure').onclick = () => showSection('heure');
        document.getElementById('btn-dates').onclick = () => showSection('dates');
        document.getElementById('btn-autres').onclick = () => showSection('autres');

        // HEURE
        let customTime = null;
        let isEditingTime = false;

        function updateClock() {
            if (isEditingTime) return;

            const now = customTime || new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            const hourDeg = (hours * 30) + (minutes * 0.5);
            const minuteDeg = (minutes * 6) + (seconds * 0.1);
            const secondDeg = seconds * 6;

            document.getElementById('hour-hand').style.transform = `translate(-50%, -100%) rotate(${hourDeg}deg)`;
            document.getElementById('minute-hand').style.transform = `translate(-50%, -100%) rotate(${minuteDeg}deg)`;
            document.getElementById('second-hand').style.transform = `translate(-50%, -100%) rotate(${secondDeg}deg)`;

            const pad = (num) => String(num).padStart(2, '0');
            const timeText = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
            document.getElementById('time-text').textContent = timeText;

            const fullHour = now.getHours();
            const minute = now.getMinutes();
            const second = now.getSeconds();

            const vietnameseHours = [
                "M∆∞·ªùi hai", "M·ªôt", "Hai", "Ba", "B·ªën", "NƒÉm",
                "S√°u", "B·∫£y", "T√°m", "Ch√≠n", "M∆∞·ªùi", "M∆∞·ªùi m·ªôt"
            ];

            const vietnameseMinutes = [
                "kh√¥ng", "m·ªôt", "hai", "ba", "b·ªën", "nƒÉm", "s√°u", "b·∫£y", "t√°m", "ch√≠n",
                "m∆∞·ªùi", "m∆∞·ªùi m·ªôt", "m∆∞·ªùi hai", "m∆∞·ªùi ba", "m∆∞·ªùi b·ªën", "m∆∞·ªùi lƒÉm",
                "m∆∞·ªùi s√°u", "m∆∞·ªùi b·∫£y", "m∆∞·ªùi t√°m", "m∆∞·ªùi ch√≠n", "hai m∆∞∆°i", "hai m∆∞∆°i m·ªët",
                "hai m∆∞∆°i hai", "hai m∆∞∆°i ba", "hai m∆∞∆°i t∆∞", "hai m∆∞∆°i lƒÉm", "hai m∆∞∆°i s√°u",
                "hai m∆∞∆°i b·∫£y", "hai m∆∞∆°i t√°m", "hai m∆∞∆°i ch√≠n", "ba m∆∞∆°i", "ba m∆∞∆°i m·ªët",
                "ba m∆∞∆°i hai", "ba m∆∞∆°i ba", "ba m∆∞∆°i t∆∞", "ba m∆∞∆°i lƒÉm", "ba m∆∞∆°i s√°u",
                "ba m∆∞∆°i b·∫£y", "ba m∆∞∆°i t√°m", "ba m∆∞∆°i ch√≠n", "b·ªën m∆∞∆°i", "b·ªën m∆∞∆°i m·ªët",
                "b·ªën m∆∞∆°i hai", "b·ªën m∆∞∆°i ba", "b·ªën m∆∞∆°i t∆∞", "b·ªën m∆∞∆°i lƒÉm", "b·ªën m∆∞∆°i s√°u",
                "b·ªën m∆∞∆°i b·∫£y", "b·ªën m∆∞∆°i t√°m", "b·ªën m∆∞∆°i ch√≠n", "nƒÉm m∆∞∆°i", "nƒÉm m∆∞∆°i m·ªët",
                "nƒÉm m∆∞∆°i hai", "nƒÉm m∆∞∆°i ba", "nƒÉm m∆∞∆°i t∆∞", "nƒÉm m∆∞∆°i lƒÉm", "nƒÉm m∆∞∆°i s√°u",
                "nƒÉm m∆∞∆°i b·∫£y", "nƒÉm m∆∞∆°i t√°m", "nƒÉm m∆∞∆°i ch√≠n"
            ];

            const vietnameseSeconds = vietnameseMinutes;

            // Determine time of day
            let timeOfDay = "";
            if (fullHour >= 0 && fullHour < 5) {
                timeOfDay = "ƒë√™m";
            } else if (fullHour >= 5 && fullHour < 11) {
                timeOfDay = "s√°ng";
            } else if (fullHour >= 11 && fullHour < 13) {
                timeOfDay = "tr∆∞a";
            } else if (fullHour >= 13 && fullHour < 18) {
                timeOfDay = "chi·ªÅu";
            } else if (fullHour >= 18 && fullHour < 22) {
                timeOfDay = "t·ªëi";
            } else {
                timeOfDay = "ƒë√™m";
            }

            // Get 12-hour display
            let displayHour = fullHour % 12;
            if (displayHour === 0) displayHour = 12;
            const nextHour = (displayHour % 12) + 1;

            let vietnameseHour = vietnameseHours[displayHour % 12];
            const vietnameseNextHour = vietnameseHours[nextHour % 12];
            const vietnameseMinute = vietnameseMinutes[minute];
            const vietnameseSecond = vietnameseSeconds[second];

            // Special case: n·ª≠a ƒë√™m
            const isMidnight = fullHour === 0 && minute === 0 && second === 0;
            if (isMidnight) {
                vietnameseHour = "N·ª≠a ƒë√™m";
            }

            // === Full formal version ===
            let vietnameseTextFull = `<strong>${vietnameseHour}</strong> gi·ªù`;
            if (minute > 0) vietnameseTextFull += ` <strong>${vietnameseMinute}</strong> ph√∫t`;
            if (second > 0) vietnameseTextFull += ` <strong>${vietnameseSecond}</strong> gi√¢y`;
            vietnameseTextFull += ` ${timeOfDay}.`;

            // === Spoken version ===
            let vietnameseTextSpoken = "";
            if (minute === 30) {
                vietnameseTextSpoken = `<strong>${vietnameseHour}</strong> gi·ªù <strong>r∆∞·ª°i</strong>`;
            } else if (minute === 45) {
                vietnameseTextSpoken = `<strong>${vietnameseNextHour}</strong> gi·ªù <strong>k√©m ${vietnameseMinutes[15]}</strong>`;
            } else if (minute === 50) {
                vietnameseTextSpoken = `<strong>${vietnameseNextHour}</strong> gi·ªù <strong>k√©m ${vietnameseMinutes[10]}</strong>`;
            } else if (minute === 55) {
                vietnameseTextSpoken = `<strong>${vietnameseNextHour}</strong> gi·ªù <strong>k√©m ${vietnameseMinutes[5]}</strong>`;
            } else {
                vietnameseTextSpoken = `<strong>${vietnameseHour}</strong> gi·ªù`;
                if (minute > 0) vietnameseTextSpoken += ` <strong>${vietnameseMinute}</strong> ph√∫t`;
            }
            if (second > 0) vietnameseTextSpoken += ` <strong>${vietnameseSecond}</strong> gi√¢y`;
            vietnameseTextSpoken += ` ${timeOfDay}.`;

            // === Display block with stable layout ===
            const block = document.getElementById('vietnamese-text');

            if (vietnameseTextFull === vietnameseTextSpoken) {
                block.innerHTML = `
                    <div style="min-height: 1.6em;">
                        ${vietnameseTextFull}
                    </div>
                    <div style="visibility: hidden; height: 1.6em;">
                        (invisible filler)
                    </div>`;
            } else {
                block.innerHTML = `
                    <div><em>ƒê·∫ßy ƒë·ªß:</em> ${vietnameseTextFull}</div>
                    <div><em>Th√¢n m·∫≠t:</em> ${vietnameseTextSpoken}</div>`;
            }
        }

        function rotateHand(event, handId) {
            const clock = document.getElementById('clock');
            const rect = clock.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const angle = Math.atan2(event.clientY - centerY, event.clientX - centerX) * (180 / Math.PI) + 90;
            const normalizedAngle = (angle + 360) % 360;

            document.getElementById(handId).style.transform = `translate(-50%, -100%) rotate(${normalizedAngle}deg)`;

            customTime = customTime || new Date();

            if (handId === 'hour-hand') {
                const hours = Math.round(normalizedAngle / 30) % 12;
                customTime.setHours(hours);
            } else if (handId === 'minute-hand') {
                const minutes = Math.round(normalizedAngle / 6) % 60;
                customTime.setMinutes(minutes);
            } else if (handId === 'second-hand') {
                const seconds = Math.round(normalizedAngle / 6) % 60;
                customTime.setSeconds(seconds);
            }

            updateClock();
        }

        ['hour-hand', 'minute-hand', 'second-hand'].forEach((id) => {
            document.getElementById(id).addEventListener('mousedown', (event) => {
                customTime = customTime || new Date();
                const moveHandler = (e) => rotateHand(e, id);
                document.addEventListener('mousemove', moveHandler);
                document.addEventListener('mouseup', () => {
                    document.removeEventListener('mousemove', moveHandler);
                }, { once: true });
            });
        });

        const timeInput = document.getElementById('time-text');

        // User starts editing: pause updates
        timeInput.addEventListener('focus', () => {
            isEditingTime = true;
        });

        // On blur or Enter: apply changes and resume updates
        function parseManualTime() {
            const text = timeInput.textContent.trim();
            const match = text.match(/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/);

            if (match) {
                const h = parseInt(match[1]);
                const m = parseInt(match[2]);
                const s = parseInt(match[3]);

                if (
                    h >= 0 && h <= 23 &&
                    m >= 0 && m <= 59 &&
                    s >= 0 && s <= 59
                ) {
                    customTime = new Date();
                    customTime.setHours(h, m, s);
                }
            }

            isEditingTime = false;
            updateClock(); // always reflect parsed time
        }

        timeInput.addEventListener('blur', parseManualTime);

        timeInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // prevent new line
                timeInput.blur();   // triggers parse + resume
            }
        });


        setInterval(() => {
            if (!customTime) {
                updateClock();
            }
        }, 1000);
        updateClock();

    </script>

    <script>
        // 1) Jours de la semaine en vietnamien (0 = dimanche ‚Ä¶ 6 = samedi)
        const vietnameseWeekdays = [
        "Ch·ªß Nh·∫≠t",
        "Th·ª© Hai",
        "Th·ª© Ba",
        "Th·ª© T∆∞",
        "Th·ª© NƒÉm",
        "Th·ª© S√°u",
        "Th·ª© B·∫£y"
        ];

        // 2) Mois en vietnamien (d√©j√† pr√©fix√©s par "Th√°ng ...")
        const monthNamesVietnamese = [
        "Th√°ng M·ªôt",
        "Th√°ng Hai",
        "Th√°ng Ba",
        "Th√°ng T∆∞",
        "Th√°ng NƒÉm",
        "Th√°ng S√°u",
        "Th√°ng B·∫£y",
        "Th√°ng T√°m",
        "Th√°ng Ch√≠n",
        "Th√°ng M∆∞·ªùi",
        "Th√°ng M∆∞·ªùi M·ªôt",
        "Th√°ng M∆∞·ªùi Hai"
        ];

        // 3) Variables globales pour suivre le mois et l‚Äôann√©e affich√©s
        let currentYear, currentMonth; // currentMonth : 0 = janvier ‚Ä¶ 11 = d√©cembre

        // 4) R√©f√©rences aux √©l√©ments DOM
		const monthYearElem = document.getElementById("month-year");
		const yearSelect    = document.getElementById("year-select");
        const calendarBody   = document.getElementById("calendar-body");
        const prevBtn        = document.getElementById("prev-month");
        const nextBtn        = document.getElementById("next-month");
        const dateDisplay    = document.getElementById("date-display");

		// Quand on clique sur le titre, on passe en mode √©dition ann√©e
		monthYearElem.addEventListener("click", () => {
			monthYearElem.style.display = "none";
			yearSelect.style.display   = "inline-block";
			yearSelect.focus();
		});

		// √Ä la s√©lection ou sortie du select, on remet √† jour et on revient au titre
		yearSelect.addEventListener("change", () => {
			currentYear = parseInt(yearSelect.value);
			buildCalendar(currentYear, currentMonth);
			showTodayDateText();
		});

		yearSelect.addEventListener("blur", () => {
			yearSelect.style.display    = "none";
			monthYearElem.style.display = "inline-block";
		});

        // 5) Initialisation d√®s que la page est compl√®tement charg√©e
        document.addEventListener("DOMContentLoaded", function() {
        // R√©cup√©rer la date d‚Äôaujourd‚Äôhui
        const today = new Date();
        currentYear  = today.getFullYear();
        currentMonth = today.getMonth();

		populateYearSelect(currentYear);
		attachSelectListeners();

        // Construire le calendrier pour le mois/ann√©e actuels
        buildCalendar(currentYear, currentMonth);

		// Afficher la date du jour par d√©faut
        showTodayDateText();

        // √âcouteurs sur les fl√®ches ‚Äú‚Äπ‚Äù et ‚Äú‚Ä∫‚Äù
        prevBtn.addEventListener("click", () => {
            currentMonth--;
            if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
            }
            buildCalendar(currentYear, currentMonth);
			showTodayDateText();
        });

        nextBtn.addEventListener("click", () => {
            currentMonth++;
            if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
            }
            buildCalendar(currentYear, currentMonth);
			showTodayDateText();
        });
        });

		function populateYearSelect(centerYear) {
			const yearSelect = document.getElementById("year-select");
			const range = 150; // +/- 10 ans autour de l'ann√©e courante
			for (let y = centerYear - range; y <= centerYear + range; y++) {
				const opt = document.createElement("option");
				opt.value = y;
				opt.textContent = y;
				yearSelect.appendChild(opt);
			}
		}

		function attachSelectListeners() {
			const ys = document.getElementById("year-select");

			// position initiale
			ys.value = currentYear;

			ys.addEventListener("change", () => {
				currentYear = parseInt(ys.value);
				buildCalendar(currentYear, currentMonth);
				showTodayDateText();
		});

		// Garder vos fl√®ches pour navigation rapide
		prevBtn.addEventListener("click", () => {
				currentMonth--;
				if (currentMonth < 0) {
				currentMonth = 11;
				currentYear--;
				}
				syncSelectsAndRebuild();
		});

		nextBtn.addEventListener("click", () => {
				currentMonth++;
				if (currentMonth > 11) {
				currentMonth = 0;
				currentYear++;
				}
				syncSelectsAndRebuild();
			});
		}

		function syncSelectsAndRebuild() {
			document.getElementById("month-select").value = currentMonth;
			document.getElementById("year-select").value  = currentYear;
			buildCalendar(currentYear, currentMonth);
			showTodayDateText();
		}

		// Fonction pour afficher la date du jour dans le texte vietnamien
        function showTodayDateText() {
			const today = new Date();
     		const weekdayIndex = today.getDay();
        	const d = today.getDate(),
			m = today.getMonth() + 1,
			y = today.getFullYear();
			const vietText =
				`<strong>${vietnameseWeekdays[weekdayIndex]}</strong>, ng√†y <strong>${d}</strong> th√°ng <strong>${m}</strong> nƒÉm <strong>${y}</strong>`;
			dateDisplay.innerHTML = vietText;
		}

		function buildCalendar(year, month) {
			// 1) Vider l'ancien contenu
			calendarBody.innerHTML = "";

			// 2) Calcul du premier jour (Lundi = 0 ‚Ä¶ Dimanche = 6)
			let firstDay = new Date(year, month, 1).getDay();      // 0 = dimanche
			firstDay = (firstDay === 0) ? 6 : firstDay - 1;        // d√©caler

			// 3) Jours dans le mois courant ET pr√©c√©dent
			const daysInMonth       = new Date(year, month + 1, 0).getDate();
			const daysInPrevMonth   = new Date(year, month, 0).getDate();

			// 4) Total cases
			const totalCells = 42;

			// 5) G√©n√©ration
			let row, dayCounter = 1, nextMonthDay = 1;
			for (let i = 0; i < totalCells; i++) {
				if (i % 7 === 0) {
				row = document.createElement("tr");
				calendarBody.appendChild(row);
				}

				const cell = document.createElement("td");

				if (i < firstDay) {
				// avant le 1·µâ ≥, on prend la fin du mois pr√©c√©dent
				const day = daysInPrevMonth - (firstDay - 1 - i);
				cell.textContent = day;
				cell.classList.add("blank", "prev-month");
				}
				else if (dayCounter <= daysInMonth) {
				// jours du mois courant
				cell.textContent = dayCounter;

				// marquer aujourd‚Äôhui
				const today = new Date();
				if (
					dayCounter === today.getDate() &&
					month === today.getMonth() &&
					year === today.getFullYear()
				) cell.classList.add("today");

				// clic
				(function(d, m, y, elt) {
					elt.addEventListener("click", () => selectDate(d, m, y, elt));
				})(dayCounter, month, year, cell);

				dayCounter++;
				}
				else {
				// apr√®s la fin du mois : jours du mois suivant
				cell.textContent = nextMonthDay++;
				cell.classList.add("blank", "next-month");
				}

				row.appendChild(cell);
			}

			// 6) Mettre √† jour le titre mois + ann√©e
			monthYearElem.textContent = `${monthNamesVietnamese[month]} ${year}`;
		}

        // 7) Fonction appel√©e quand on clique sur une date (d, m, y)
        function selectDate(d, m, y, cellElem) {
			// 7.1) Retirer ‚Äúselected‚Äù de la case qui en avait d√©j√†
			const prevSel = document.querySelector(".cal-table tbody .selected");
			if (prevSel) {
				prevSel.classList.remove("selected");
			}

			// 7.2) Ajouter ‚Äúselected‚Äù √† la cellule cliqu√©e
			cellElem.classList.add("selected");

			// 7.3) Construire la phrase vietnamienne du type :
			// ‚ÄúTh·ª© S√°u, ng√†y 06 th√°ng 06 nƒÉm 2025‚Äù
			const clickedDate = new Date(y, m, d);
			const weekdayIndex = clickedDate.getDay(); // 0 = dimanche

			const vietText =
				`<strong>${vietnameseWeekdays[weekdayIndex]}</strong>, ng√†y <strong>${d}</strong> th√°ng <strong>${m + 1}</strong> nƒÉm <strong>${y}</strong>`;

			// 7.4) Injecter dans le <p id="date-display">
			dateDisplay.innerHTML = vietText;
        }
    </script>


</body>
</html>
